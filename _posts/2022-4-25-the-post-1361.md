---
categories:
  - 技术
comment: 
date: '2022-4-25'
info: 
layout: post
published: true
sha: 04eba15d564904adef8da5aff8d58ecfa1a41a1e
slug: the-post-1361
tags:
  - 技术
  - ' jekylle'
  - python
title: Gitalk批量及自动初始化
type: post

---
前面聊到我在blog的repo内做了Gitalk的适配，然后也有离线的脚本做了一次将近七百篇文章的批量初始化的动作，原本是打算不再去做自动初始化的Action内容了，但是出于对Github Action本身的兴趣，我还是打算把这段时间的一些零零碎碎的工作整理下，因为这里有些步骤的内容，可能的确并不好找，即使是本来并非使用Gitalk而只是和我一样刚接触Github Action的人也可以有所参考。

内容就逐步更新吧—— **顺便，这是也是第一次正好测试自动初始化功能的文章，刚才从结果看，一切正常**

## 关于Gitalk安装使用与配置
以下部分引用自[Gitalk的Github页面](https://github.com/gitalk/gitalk)
> 
Gitalk 是一个基于 GitHub Issue 和 Preact 开发的评论插件。

## 特性

- 使用 GitHub 登录
- 支持多语言 [en, zh-CN, zh-TW, es-ES, fr, ru, de, pl, ko, fa, ja]
- 支持个人或组织
- 无干扰模式（设置 distractionFreeMode 为 true 开启）
- 快捷键提交评论 （cmd|ctrl + enter）

[Readme](https://github.com/gitalk/gitalk/blob/master/readme.md)
[在线示例](https://gitalk.github.io)

Github上作者已经有了很不错的文档描述，只需要按部就班的按照Install的指示执行，如果说哪里还有稍微可以说得更清楚的地方，那就是在Gitalk配置中js部分提到的repo是指用来放置issue/评论的repo而不是blog本身所在的repo；而admin部分就是指定有资格初始化评论的github用户名——初始化的方法很简单，只需要具备权限的用户打开某一篇文章，那么就会自动刷新建立评论对应的issue。

换言之，如果作者写完文章推送之后并没主动访问编译后的文章页面，而其他人先访问，就会看到说评论issue不存在，请联系@xxx之类的错误提示；这也是为什么很多人觉得Gitalk不方便的原因。

对于新建文章问题可能还不大，但是对于如果有大量存量文章想转移到Gitalk的人，就不太友好了。

但是，作者也解释了，这么做有着安全上的考虑，即，假如任何人都能触发新建评论（即对应issue），那么理论上issue也能被随意删除和篡改；有些其他的方案通过一个第三方的server来实现集中化的管理（比如，可授权的Github App），这个思路就很可取，其实和我下面做的Action本质上是一样的，那就是托管Admin的token来实现issue的自动化初始和安全并存。

我把相应的脚本和内容整理到了[GitHub](https://github.com/shinemoon/GitalkAutoAction)并将在下面做一点展开解释。

## 本地执行批量话初始评论区

## Github Action自动为新文章初始化Gitalk评论

